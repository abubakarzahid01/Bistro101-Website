<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users - Restaurant Admin</title>

    <link rel="stylesheet" href="styles.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
<div class="admin-wrapper">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon"><i class="fa-solid fa-utensils"></i></div>
            <h2>Restaurant Admin</h2>
            <p>Management Dashboard</p>
        </div>

        <nav class="nav-menu">
            <a href="dashboard.html" class="nav-item">
                <i class="fa-solid fa-chart-line nav-icon"></i><span>Dashboard</span>
            </a>

            <a href="orders.html" class="nav-item">
                <i class="fa-solid fa-cart-shopping nav-icon"></i><span>Orders</span>
            </a>

            <a href="users.html" class="nav-item active">
                <i class="fa-solid fa-users nav-icon"></i><span>Users</span>
            </a>

            <a href="bookings.html" class="nav-item">
                <i class="fa-solid fa-calendar-check nav-icon"></i><span>Bookings</span>
            </a>

            <a href="reviews.html" class="nav-item">
                <i class="fa-solid fa-star nav-icon"></i><span>Reviews</span>
            </a>

            <a href="newsletter.html" class="nav-item">
                <i class="fa-solid fa-envelope-open-text nav-icon"></i><span>Newsletter</span>
            </a>
        </nav>
    </aside>


    <!-- MAIN CONTENT -->
    <main class="main-content">

        <div class="top-header">
            <h1 class="page-title">Users Management</h1>

            <div class="admin-info">
                <div class="admin-avatar">A</div>
                <div class="admin-details">
                    <h4>Admin</h4>
                    <p>Administrator</p>
                </div>
            </div>
        </div>


        <!-- USERS TABLE -->
        <div class="content-card">

            <div class="card-top">
                <h2><i class="fa-solid fa-users section-emoji"></i> All Users</h2>
                <button class="refresh-button" onclick="loadUsers()">Refresh</button>
            </div>

            <div id="users-data"></div>

        </div>

    </main>
</div>


<!-- EDIT USER MODAL -->
<div id="editModal" class="modal hidden">
    <div class="modal-content">
        <h2>Edit User</h2>

        <input type="text" id="editName" placeholder="Name">
        <input type="email" id="editEmail" placeholder="Email">
        <input type="text" id="editPhone" placeholder="Phone">

        <div class="modal-buttons">
            <button class="save-btn" onclick="saveUser()">Save</button>
            <button class="cancel-btn" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>


<script>
const API_URL = "https://bistro101-backend.onrender.com/api";
let currentEditId = null;


// Load all users
async function loadUsers() {
    const container = document.getElementById("users-data");

    container.innerHTML = `
        <div class="loading-state">
            <div class="spinner"></div>
            <p>Loading users...</p>
        </div>
    `;

    try {
        const response = await fetch(`${API_URL}/auth/users`);
        const data = await response.json();

        if (!data.success || !data.users || data.users.length === 0) {
            container.innerHTML = `
                <div class="empty-box">
                    <div class="empty-icon"><i class="fa-solid fa-users-slash"></i></div>
                    <p>No users found</p>
                </div>
            `;
            return;
        }

        let html = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
        `;

        data.users.forEach(user => {
            html += `
                <tr>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || "Not provided"}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button class="table-btn edit" onclick="openEditModal('${user._id}', '${user.name}', '${user.email}', '${user.phone || ""}')">
                            <i class="fa-solid fa-pen"></i>
                        </button>

                        <button class="table-btn delete" onclick="deleteUser('${user._id}')">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        });

        html += "</tbody></table>";
        container.innerHTML = html;

    } catch (error) {
        console.error(error);

        container.innerHTML = `
            <div class="empty-box">
                <p>Error loading users</p>
            </div>
        `;
    }
}




// OPEN EDIT MODAL
function openEditModal(id, name, email, phone) {
    currentEditId = id;
    document.getElementById("editName").value = name;
    document.getElementById("editEmail").value = email;
    document.getElementById("editPhone").value = phone;

    document.getElementById("editModal").classList.remove("hidden");
}


// CLOSE MODAL
function closeModal() {
    document.getElementById("editModal").classList.add("hidden");
}



// SAVE UPDATED USER
async function saveUser() {
    const name = document.getElementById("editName").value;
    const email = document.getElementById("editEmail").value;
    const phone = document.getElementById("editPhone").value;

    const response = await fetch(`${API_URL}/auth/users/${currentEditId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, phone })
    });

    const data = await response.json();

    if (data.success) {
        alert("User updated successfully!");
        closeModal();
        loadUsers();
    } else {
        alert("Update failed");
    }
}



// DELETE USER
async function deleteUser(id) {
    if (!confirm("Are you sure you want to delete this user?")) return;

    const response = await fetch(`${API_URL}/auth/users/${id}`, {
        method: "DELETE"
    });

    const data = await response.json();

    if (data.success) {
        alert("User deleted.");
        loadUsers();
    } else {
        alert("Delete failed");
    }
}


window.onload = loadUsers;
</script>

<style>
/* Quick modal styles (put into your CSS if needed) */
.modal {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    display:flex; align-items:center; justify-content:center;
}
.modal.hidden { display:none; }

.modal-content {
    background:#1e2230;
    padding:20px;
    border-radius:10px;
    width:350px;
}

.modal-content input {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:5px;
    border:none;
    background:#2c3244;
    color:#fff;
}

.modal-buttons { display:flex; gap:10px; margin-top:10px; }
.save-btn { background:#2e8bff; padding:10px; border:none; width:100%; border-radius:5px; }
.cancel-btn { background:#ff4444; padding:10px; border:none; width:100%; border-radius:5px; }

.table-btn {
    background:#2c3244;
    border:none;
    padding:6px 10px;
    border-radius:6px;
    cursor:pointer;
    color:white;
}
.table-btn.edit { background:#2e8bff; }
.table-btn.delete { background:#ff4444; }
</style>

</body>
</html>
